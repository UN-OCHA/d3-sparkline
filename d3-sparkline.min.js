!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):e(t,t.d3)}(this,(function(t,e){"use strict";const i={target:"#sparkline",ratio:5,size:null,font_size:null,color:"red",stroke_width:1,dasharray:"0",color_baseline:"black",stroke_width_baseline:1,dasharray_baseline:"0",point_radius:3,tooltip:null};t.SparkLine=class{constructor(t){this.set(t),this.set_dimensions(),this.init()}set(t){Object.assign(this,i,t)}set_dimensions(){if(this.font_size)this.width=this.font_size*this.ratio;else if("parent"==this.size){var t=document.querySelector(this.target);this.width=parseInt(window.getComputedStyle(t,null).getPropertyValue("width"))}else{var e=document.querySelector(this.target),i=parseInt(window.getComputedStyle(e,null).getPropertyValue("font-size"));this.width=i*this.ratio}this.height=this.width/this.ratio}init(){this.chart=e.select(this.target).style("position","relative").append("svg").attr("class","d3-sparkline").attr("width",this.width).attr("height",this.height+2*this.point_radius).style("padding",this.point_radius+"px").style("overflow","visible").append("g"),this.hasTooltips()&&(this.tooltip_container=e.select("body").append("div").attr("class","d3-sparkline-tooltip tooltip top").style("opacity","0.9").style("position","absolute").style("visibility","hidden"),this.focussed_point=null)}hasTooltips(){return"undefined"!=this.tooltip&&null!=this.tooltip}isMiddlePoint(t,e){let i=this.getPreviousPointIndex(t,e),n=this.getNextPointIndex(t,e);return null!==i&&null!==n&&(this.hasPoint(t,this.getPreviousPointIndex(t,e))&&this.hasPoint(t,this.getNextPointIndex(t,e)))}hasPoint(t,e){return"number"==typeof t[e]&&!Number.isNaN(t[e])}getPreviousPointIndex(t,e){if(e<=0)return null;for(let i=e-1;i>=0;i--)if(this.hasPoint(t,i))return i;return null}getNextPointIndex(t,e){if(e>=t.length-1)return null;for(let i=e+1;i<t.length;i++)if(this.hasPoint(t,i))return i;return null}getNullableY(t,e,i,n){if(Number.isNaN(e)){if(this.isMiddlePoint(n,i)){let e=this.getPreviousPointIndex(n,i),r=this.getNextPointIndex(n,i);return t((n[e]+n[r])/2)}return t(Math.min(...n.filter((t=>!Number.isNaN(t)))))}return t(e)}render_line(t,i){let n=this;var r=e.extent(t,(t=>t));void 0!==i&&(r[1]=Math.max(r[1],i));let s=e.scaleLinear().domain(r).range([n.height,0]),a=e.scaleLinear().domain([0,t.length-1]).range([0,n.width]),o=e.line().x((function(t,e){return a(e)})).y((function(e,i){return n.getNullableY(s,e,i,t)})),l="gradient-"+URL.createObjectURL(new Blob([])).slice(-36);var d=this.chart.append("defs").append("linearGradient").attr("id",l).attr("gradientUnits","userSpaceOnUse").attr("x1","0%").attr("x2","100%");let h=a(t.length-1);for(let e=0;e<t.length-1;e++){let i=n.color;Number.isNaN(t[e])&&!n.isMiddlePoint(t,e)&&(i="transparent"),n.getNextPointIndex(t,e)||(i="transparent"),d.append("stop").attr("offset",1/h*a(e)).attr("stop-color",i),d.append("stop").attr("offset",1/h*a(e+1)).attr("stop-color",i)}if(this.chart.append("path").datum(t).attr("class","sparkline").attr("fill","transparent").attr("stroke","url(#"+l+")").attr("stroke-width",n.stroke_width).attr("stroke-dasharray",n.dasharray?n.dasharray:"0").style("stroke-linecap","round").attr("d",o),void 0!==i){let r=e.line().x((function(t,e){return a(e)})).y((function(t,e){return s(i)}));this.chart.append("path").datum(t).attr("class","sparkline-baseline").attr("fill","transparent").attr("stroke",n.color_baseline).attr("stroke-width",n.stroke_width_baseline).attr("stroke-dasharray",n.dasharray_baseline?n.dasharray_baseline:"0").style("stroke-linecap","round").attr("d",r)}this.checkTooltipVisibility=function(t){let e=t;setTimeout((function(){e.tooltip_container.node().matches(":hover")||null==e.focussed_point||e.focussed_point.matches(":hover")?e.checkTooltipVisibility(t):(e.tooltip_container.transition().duration(0).style("visibility","hidden"),e.focussed_point=null)}),100)},this.chart.selectAll("dot").data(t).enter().append("circle").attr("r",n.point_radius).attr("cx",(function(t,e){return a(e)})).attr("cy",(function(e,i){return n.getNullableY(s,e,i,t)})).attr("class",(function(t,e){return Number.isNaN(t)?"hidden":""})),this.chart.selectAll("dot").data(t).enter().append("circle").attr("r",10).attr("fill","transparent").attr("cx",(function(t,e){return a(e)})).attr("cy",(function(e,i){return n.getNullableY(s,e,i,t)})).attr("i",(function(t,e){return e})).on("mouseenter",(function(t,e){if(!n.hasTooltips())return;let i=n.tooltip(t.target.attributes.i.value);if(!i)return;n.focussed_point=this,n.tooltip_container.html(i);let r=n.tooltip_container.node().getBoundingClientRect().width,s=n.tooltip_container.node().getBoundingClientRect().height;n.tooltip_container.style("left",t.pageX-t.offsetX+t.target.cx.baseVal.value-r/2+2+"px").style("top",t.pageY-t.offsetY+t.target.cy.baseVal.value-s-2+"px"),n.tooltip_container.transition().duration(0).style("visibility","visible")})).on("mouseleave",(function(t){n.hasTooltips()&&n.checkTooltipVisibility(n)}))}render(){this.render_line(this.data,this.baseline)}update(t,e){this.data=t,this.baseline=e,this.render()}}}));
