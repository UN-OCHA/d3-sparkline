!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):e(t,t.d3)}(this,(function(t,e){"use strict";const i={target:"#sparkline",ratio:5,size:null,font_size:null,color:"red",stroke_width:1,dasharray:"0",color_baseline:"black",stroke_width_baseline:1,dasharray_baseline:"0",point_radius:3,tooltip:null};t.SparkLine=class{constructor(t){this.set(t),this.set_dimensions(),this.init()}set(t){Object.assign(this,i,t)}set_dimensions(){if(this.font_size)this.width=this.font_size*this.ratio;else if("parent"==this.size){var t=document.querySelector(this.target);this.width=parseInt(window.getComputedStyle(t,null).getPropertyValue("width"))}else{var e=document.querySelector(this.target),i=parseInt(window.getComputedStyle(e,null).getPropertyValue("font-size"));this.width=i*this.ratio}this.height=this.width/this.ratio}init(){this.chart=e.select(this.target).style("position","relative").append("svg").attr("class","d3-sparkline").attr("width",this.width).attr("height",this.height+2*this.point_radius).style("padding",this.point_radius+"px").style("overflow","visible").append("g"),this.hasTooltips()&&(this.tooltip_container=e.select("body").append("div").attr("class","tooltip top").style("opacity","0.9").style("position","absolute").style("visibility","hidden"),this.focussed_point=null)}hasTooltips(){return"undefined"!=this.tooltip&&null!=this.tooltip}render_line(t,i){let s=this;var n=e.extent(t,(t=>t));void 0!==i&&(n[1]=Math.max(n[1],i));let a=e.scaleLinear().domain(n).range([s.height,0]),r=e.scaleLinear().domain([0,t.length-1]).range([0,s.width]),o=e.line().x((function(t,e){return r(e)})).y((function(t){return a(t)}));if(this.chart.append("path").datum(t).attr("class","sparkline").attr("fill","transparent").attr("stroke",s.color).attr("stroke-width",s.stroke_width).attr("stroke-dasharray",s.dasharray?s.dasharray:"0").style("stroke-linecap","round").attr("d",o),void 0!==i){let n=e.line().x((function(t,e){return r(e)})).y((function(t,e){return a(i)}));this.chart.append("path").datum(t).attr("class","sparkline-baseline").attr("fill","transparent").attr("stroke",s.color_baseline).attr("stroke-width",s.stroke_width_baseline).attr("stroke-dasharray",s.dasharray_baseline?s.dasharray_baseline:"0").style("stroke-linecap","round").attr("d",n)}this.checkTooltipVisibility=function(t){let e=t;setTimeout((function(){e.tooltip_container.node().matches(":hover")||null==e.focussed_point||e.focussed_point.matches(":hover")?e.checkTooltipVisibility(t):(e.tooltip_container.transition().duration(0).style("visibility","hidden"),e.focussed_point=null)}),100)},this.chart.selectAll("dot").data(t).enter().append("circle").attr("r",s.point_radius).attr("cx",(function(t,e){return r(e)})).attr("cy",(function(t){return a(t)})),this.chart.selectAll("dot").data(t).enter().append("circle").attr("r",10).attr("fill","transparent").attr("cx",(function(t,e){return r(e)})).attr("cy",(function(t){return a(t)})).attr("i",(function(t,e){return e})).on("mouseenter",(function(t,e){if(!s.hasTooltips())return;s.focussed_point=this,s.tooltip_container.html(s.tooltip(t.target.attributes.i.value));let i=s.tooltip_container.node().getBoundingClientRect().width,n=s.tooltip_container.node().getBoundingClientRect().height;s.tooltip_container.style("left",t.pageX-t.offsetX+t.target.cx.baseVal.value-i/2+2+"px").style("top",t.pageY-t.offsetY+t.target.cy.baseVal.value-n-2+"px"),s.tooltip_container.transition().duration(0).style("visibility","visible")})).on("mouseleave",(function(t){s.hasTooltips()&&s.checkTooltipVisibility(s)}))}render(){this.render_line(this.data,this.baseline)}update(t,e){this.data=t,this.baseline=e,this.render()}}}));
