!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):e(t,t.d3)}(this,(function(t,e){"use strict";const i={target:"#sparkline",ratio:5,font_size:12,auto:!1,color:"red",stroke_width:1,dasharray:"0",color_baseline:"black",stroke_width_baseline:1,dasharray_baseline:"0",point_radius:3,tooltip:null};t.SparkLine=class{constructor(t){this.set(t),this.set_dimensions(),this.init()}set(t){Object.assign(this,i,t)}set_dimensions(){if(this.auto){let t=document.querySelector(target),e=parseInt(window.getComputedStyle(t,null).getPropertyValue("font-size"));this.width=e*this.ratio,this.height=e}else this.width=this.font_size*this.ratio,this.height=this.font_size}init(){let{width:t,height:i,target:n,ratio:s}=this;this.chart=e.select(n).style("position","relative").append("svg").attr("class","d3-sparkline").attr("width",t).attr("height",i+2*this.point_radius).style("padding",this.point_radius+"px").style("overflow","visible").append("g"),this.hasTooltips()&&(this.tooltip_container=e.select("body").append("div").attr("class","tooltip top").style("opacity","0.9").style("position","absolute").style("visibility","hidden"),this.focussed_point=null)}hasTooltips(){return"undefined"!=this.tooltip&&null!=this.tooltip}render_line(t,i){let n=this;var s=e.extent(t,(t=>t));void 0!==i&&(s[1]=Math.max(s[1],i));let a=e.scaleLinear().domain(s).range([n.height,0]),o=e.scaleLinear().domain([0,t.length]).range([0,n.width]),r=e.line().x((function(t,e){return o(e)})).y((function(t){return a(t)}));if(this.chart.append("path").datum(t).attr("class","sparkline").attr("fill","transparent").attr("stroke",n.color).attr("stroke-width",n.stroke_width).attr("stroke-dasharray",n.dasharray?n.dasharray:"0").style("stroke-linecap","round").attr("d",r),void 0!==i){let s=e.line().x((function(t,e){return o(e)})).y((function(t,e){return a(i)}));this.chart.append("path").datum(t).attr("class","sparkline-baseline").attr("fill","transparent").attr("stroke",n.color_baseline).attr("stroke-width",n.stroke_width_baseline).attr("stroke-dasharray",n.dasharray_baseline?n.dasharray_baseline:"0").style("stroke-linecap","round").attr("d",s)}this.checkTooltipVisibility=function(t){let e=t;setTimeout((function(){e.tooltip_container.node().matches(":hover")||null==e.focussed_point||e.focussed_point.matches(":hover")?e.checkTooltipVisibility(t):(e.tooltip_container.transition().duration(0).style("visibility","hidden"),e.focussed_point=null)}),100)},this.chart.selectAll("dot").data(t).enter().append("circle").attr("r",n.point_radius).attr("cx",(function(t,e){return o(e)})).attr("cy",(function(t){return a(t)})),this.chart.selectAll("dot").data(t).enter().append("circle").attr("r",10).attr("fill","transparent").attr("cx",(function(t,e){return o(e)})).attr("cy",(function(t){return a(t)})).attr("i",(function(t,e){return e})).on("mouseenter",(function(t,e){if(!n.hasTooltips())return;n.focussed_point=this,n.tooltip_container.html(n.tooltip(t.target.attributes.i.value));let i=n.tooltip_container.node().getBoundingClientRect().width,s=n.tooltip_container.node().getBoundingClientRect().height;n.tooltip_container.style("left",t.pageX-t.offsetX+t.target.cx.baseVal.value-i/2+2+"px").style("top",t.pageY-t.offsetY+t.target.cy.baseVal.value-s-2+"px"),n.tooltip_container.transition().duration(0).style("visibility","visible")})).on("mouseleave",(function(t){n.hasTooltips()&&n.checkTooltipVisibility(n)}))}render(){this.render_line(this.data,this.baseline)}update(){this.render(this.data,this.baseline,options)}}}));
